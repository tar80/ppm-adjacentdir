Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var i=null!=e?e:0;if(Math.abs(i)===Infinity&&(i=0),i>=a)return-1;for(r=Math.max(i>=0?i:a-Math.abs(i),0);r<a;){if(r in n&&n[r]===t)return r;r++}return-1});var isEmptyStr=function(t){return""===t},isError=function(t,e){return t&&"string"==typeof e},t=PPx.CreateObject("Scripting.FileSystemObject"),expandNlCode=function(t){var e="\n",r=t.indexOf("\r");return~r&&(e="\r\n"==t.substring(r,r+2)?"\r\n":"\r"),e},e={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"ja"===t?t:e.language},tmp=function(){var t=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:t,file:t+"_ppmtemp",lf:t+"_temp.xlf",stdout:t+"_stdout",stderr:t+"_stderr",ppmDir:function(){var t=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+t),t}}},exec=function(t,e){try{var r;return[!1,null!=(r=e())?r:""]}catch(n){return[!0,""]}finally{t.Close()}},read=function(e){var r=e.path,n=e.enc,a=void 0===n?"utf8":n;if(!t.FileExists(r))return[!0,r+" not found"];var i=t.GetFile(r);if(0===i.Size)return[!0,r+" has no data"];var o=!1,u="";if("utf8"===a){var s=PPx.CreateObject("ADODB.Stream"),p=exec(s,(function(){return s.Open(),s.Charset="UTF-8",s.LoadFromFile(r),s.ReadText(-1)}));o=p[0],u=p[1]}else{var c="utf16le"===a?-1:0,l=i.OpenAsTextStream(1,c),f=exec(l,(function(){return l.ReadAll()}));o=f[0],u=f[1]}return o?[!0,"Unable to read "+r]:[!1,u]},readLines=function(t){var e,r=t.path,n=t.enc,a=void 0===n?"utf8":n,i=t.linefeed,o=read({path:r,enc:a}),u=o[0],s=o[1];if(u)return[!0,s];i=null!=(e=i)?e:expandNlCode(s.slice(0,1e3));var p=s.split(i);return isEmptyStr(p[p.length-1])&&p.pop(),[!1,{lines:p,nl:i}]},validArgs=function(){for(var t=[],e=PPx.Arguments;!e.atEnd();e.moveNext())t.push(e.value);return t},r="%sgu'ppmlib'\\discardStayMode.js",ppx_Discard=function(t,e){var r;PPx.StayMode=0,e=null!=(r=e)?r:"","DEBUG"===t&&PPx.linemessage("[DEBUG] discard "+e)},n={hold:function(t,e){var n=PPx.StayMode,a="ppm_sm"+n;PPx.Execute("*run -noppb -hide -nostartmsg %0ppbw.exe -c *wait "+t+"%%:*script "+r+","+a+","+n+","+e)}},a={sortDetail:function(t,e,r){return 0!==t&&(t=1),{0:{l:-1,r:1,msg:e},1:{l:1,r:-1,msg:r}}[t]},pathDetail:function(t){var e={path:"",wd:"",name:"",ext:"",type:0},r=/^(.*)\\((?:.*\.)?(?!$)(.*))/;return PPx.Extract(t).replace(r,(function(t,r,n,a){return e.path=t+"\\",e.wd=r,e.name=n,e.ext="."+a.toLowerCase(),e.type=PPx.DirectoryType,""})),e.wd?e:undefined}},i={root:"<<root>>",top:"<top>",bottom:"<bottom>"},o={en:{noItem:"No adjacent directories",notSupport:"Not supported"},ja:{noItem:"隣接ディレクトリはありません",notSupport:"非対象"}}[useLanguage()],u={wd:"",ext:"",data:{}},main=function(){var t=validArgs(),e=t[0],r=t[1],a=t[2],i=hasDebounceTime(r);i&&(PPx.StayMode=2,"DEBUG"===a&&PPx.linemessage("[DEBUG] start "+PPx.StayMode),n.hold(r,a)),ppx_resume(e,"0",i)},ppx_finally=function(){return PPx.Echo("[WARN] instance remain moveDirectory.stay.js")},ppx_resume=function(t,e,r){void 0===t&&(t="1"),void 0===e&&(e="5000"),void 0===r&&(r=!0);var n=a.sortDetail(Number(t),i.top,i.bottom),o=getPwd(),u=o[0],s=o[1],p=a.pathDetail(u);if(p){var c=candidates(p,n,r);if("string"!=typeof c){var l=c.indexOf(p.path),f=getAdjacentPath(l,c,u,s);if(c[l-2]||PPx.linemessage('!"'+n.msg),c[l-1]&&PPx.Execute('*jumppath "'+f+'"'),r){var d="ppm_sm"+PPx.StayMode;PPx.Execute("*string u,"+d+"="+e)}}else PPx.linemessage('!"'+c)}else PPx.linemessage('!"'+i.root)},hasDebounceTime=function(t){var e=Number(t);return!isNaN(e)&&e>=1e3},getPwd=function(){var t=PPx.Extract("%FDVN");return 0===t.indexOf("#:")?[PPx.Extract("%FDN"),t]:[t]},sortItems=function(t,e,r,n){var a;if(n&&u.wd===t.wd&&t.type<61)a=u.data;else if(n&&u.wd===t.wd&&t.type>=61&&u.ext===t.ext)a=u.data;else{var i,s=tmp().file,p='-mask:"'+r+'" -utf8 -dir:on -subdir:off -listfile:'+s+" -name";PPx.Execute('*whereis -path:"'+t.wd+'\\" '+p);var c=readLines({path:s});if(i=c[0],a=c[1],isError(i,a))return a;u={wd:t.wd,ext:t.ext,data:a}}return a.lines.length<=1?o.noItem:a.lines.sort((function(t,r){return t.toLowerCase()<r.toLowerCase()?e.l:e.r}))},candidates=function(t,e,r){switch(t.type){case 0:case 1:case 3:return sortItems(t,e,"a:d+s-",r);case 4:case 61:case 62:case 63:case 64:case 96:return t.path=t.path.slice(0,-1),sortItems(t,e,t.ext,r);default:return"DirectoryType: "+t.type+", "+o.notSupport}},getAdjacentPath=function(t,e,r,n){var a=e[Math.max(t-1,0)];if(!n)return a;var i=/[/\\][^/\\]+$/;return r=r.replace(i,""),n=n.replace(i,""),a.replace(r,n)};main();
