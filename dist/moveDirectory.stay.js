Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new TypeError('Array.indexOf: "this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var i=null!=t?t:0;if(Math.abs(i)===Infinity&&(i=0),i>=a)return-1;for(r=Math.max(i>=0?i:a-Math.abs(i),0);r<a;){if(r in n&&n[r]===e)return r;r++}return-1});var isEmptyStr=function(e){return""===e},isError=function(e,t){return e&&"string"==typeof t},e=PPx.CreateObject("Scripting.FileSystemObject"),expandNlCode=function(e){var t="\n",r=e.indexOf("\r");return~r&&(t="\r\n"==e.substring(r,r+2)?"\r\n":"\r"),t},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},read=function(t){var r=t.path,n=t.enc,a=void 0===n?"utf8":n;if(!e.FileExists(r))return[!0,r+" not found"];var i=e.GetFile(r);if(0===i.Size)return[!0,r+" has no data"];var u=!1,o="";if("utf8"===a){var s=PPx.CreateObject("ADODB.Stream"),p=exec(s,(function(){return s.Open(),s.Charset="UTF-8",s.LoadFromFile(r),s.ReadText(-1)}));u=p[0],o=p[1]}else{var l="utf16le"===a?-1:0,f=i.OpenAsTextStream(1,l),c=exec(f,(function(){return f.ReadAll()}));u=c[0],o=c[1]}return u?[!0,"Unable to read "+r]:[!1,o]},readLines=function(e){var t,r=e.path,n=e.enc,a=void 0===n?"utf8":n,i=e.linefeed,u=read({path:r,enc:a}),o=u[0],s=u[1];if(o)return[!0,s];i=null!=(t=i)?t:expandNlCode(s.slice(0,1e3));var p=s.split(i);return isEmptyStr(p[p.length-1])&&p.pop(),[!1,{lines:p,nl:i}]},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e};if(undefined){var r=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e}("","string",1,!0,undefined);r[0],r[1],r[2],r[3],r[4]}var _valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return isNaN(r)?e:r;case"boolean":return"false"!==t&&"0"!==t&&null!=t;default:return t}},discardInstance=function(e,t){var r=PPx.StayMode,n="ppm_sm"+r,a="%sgu'ppmlib'\\discardStayMode.js";PPx.Execute("*run -noppb -hide -nostartmsg %0ppbw.exe -c *wait "+e+"%%:*script "+a+","+n+","+r+","+t)},ppx_Discard=function(e,t){var r;PPx.StayMode=0,t=null!=(r=t)?r:"","DEBUG"===e&&PPx.linemessage("[DEBUG] discard "+t)},n={sortDetail:function(e,t,r){return 0!==e&&(e=1),{0:{l:-1,r:1,msg:t},1:{l:1,r:-1,msg:r}}[e]},pathDetail:function(e){var t={path:"",wd:"",name:"",ext:"",type:0},r=/^(.*)\\((?:.*\.)?(?!$)(.*))/;return PPx.Extract(e).replace(r,(function(e,r,n,a){return t.path=e+"\\",t.wd=r,t.name=n,t.ext="."+a.toLowerCase(),t.type=PPx.DirectoryType,""})),t.wd?t:undefined}},a="<<Root>>",i="<Top>",u="<Bottom>",o={en:{noItem:"No adjacent directories",notSupport:"Not supported"},ja:{noItem:"隣接ディレクトリはありません",notSupport:"非対象"}}[useLanguage()],s={},main=function(){var e=validArgs(),t=e[0],r=e[1],n=e[2],a=hasDebounceTime(r);a&&(PPx.StayMode=2,"DEBUG"===n&&PPx.linemessage("[DEBUG] start "+PPx.StayMode),discardInstance(r,n)),ppx_resume(t,"0",a)},hasDebounceTime=function(e){var t=Number(e);return!isNaN(t)&&t>=1e3},ppx_resume=function(e,t,r){void 0===e&&(e="1"),void 0===t&&(t="5000"),void 0===r&&(r=!0);var o=n.sortDetail(Number(e),i,u),s=getPwd(),p=s[0],l=s[1],f=n.pathDetail(p);if(f){var c=candidates(f,o,r);if("string"!=typeof c){var d=c.indexOf(f.path),x=getAdjacentPath(d,c,p,l);if(c[d-2]||PPx.linemessage('!"'+o.msg),c[d-1]&&PPx.Execute('*jumppath "'+x+'"'),r){var P="ppm_sm"+PPx.StayMode;PPx.Execute("*string u,"+P+"="+t)}}else PPx.linemessage('!"'+c)}else PPx.linemessage('!"'+a)},getPwd=function(){var e=PPx.Extract("%FDVN");return 0===e.indexOf("#:")?[PPx.Extract("%FDN"),e]:[e]},sortItems=function(e,t,r,n){var a;if(n&&s.wd===e.wd&&e.type<61)a=s.data;else if(n&&s.wd===e.wd&&e.type>=61&&s.ext===e.ext)a=s.data;else{var i,u=tmp().file,p='-mask:"'+r+'" -utf8 -dir:on -subdir:off -listfile:'+u+" -name";PPx.Execute('*whereis -path:"'+e.wd+'\\" '+p);var l=readLines({path:u});if(i=l[0],a=l[1],isError(i,a))return a;s={wd:e.wd,ext:e.ext,data:a}}return a.lines.length<=1?o.noItem:a.lines.sort((function(e,r){return e.toLowerCase()<r.toLowerCase()?t.l:t.r}))},candidates=function(e,t,r){switch(e.type){case 0:case 1:case 3:return sortItems(e,t,"a:d+s-",r);case 4:case 61:case 62:case 63:case 64:case 96:return e.path=e.path.slice(0,-1),sortItems(e,t,e.ext,r);default:return"DirectoryType: "+e.type+", "+o.notSupport}},getAdjacentPath=function(e,t,r,n){var a=t[Math.max(e-1,0)];if(!n)return a;var i=/[/\\][^/\\]+$/;return r=r.replace(i,""),n=n.replace(i,""),a.replace(r,n)};main();
