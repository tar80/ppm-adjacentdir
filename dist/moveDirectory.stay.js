Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new TypeError('Array.indexOf: "this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var i=null!=t?t:0;if(Math.abs(i)===Infinity&&(i=0),i>=a)return-1;for(r=Math.max(i>=0?i:a-Math.abs(i),0);r<a;){if(r in n&&n[r]===e)return r;r++}return-1});var isEmptyStr=function(e){return""===e},isError=function(e,t){return e&&"string"==typeof t},e=PPx.CreateObject("Scripting.FileSystemObject"),expandNlCode=function(e){var t="\n",r=e.indexOf("\r");return~r&&(t="\r\n"==e.substring(r,r+2)?"\r\n":"\r"),t},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},read=function(t){var r=t.path,n=t.enc,a=void 0===n?"utf8":n;if(!e.FileExists(r))return[!0,r+" not found"];var i=e.GetFile(r);if(0===i.Size)return[!0,r+" has no data"];var u=!1,o="";if("utf8"===a){var p=PPx.CreateObject("ADODB.Stream"),s=exec(p,(function(){return p.Open(),p.Charset="UTF-8",p.LoadFromFile(r),p.ReadText(-1)}));u=s[0],o=s[1]}else{var c="utf16le"===a?-1:0,l=i.OpenAsTextStream(1,c),f=exec(l,(function(){return l.ReadAll()}));u=f[0],o=f[1]}return u?[!0,"Unable to read "+r]:[!1,o]},readLines=function(e){var t,r=e.path,n=e.enc,a=void 0===n?"utf8":n,i=e.linefeed,u=read({path:r,enc:a}),o=u[0],p=u[1];if(o)return[!0,p];i=null!=(t=i)?t:expandNlCode(p.slice(0,1e3));var s=p.split(i);return isEmptyStr(s[s.length-1])&&s.pop(),[!1,{lines:s,nl:i}]},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},ppx_Discard=function(e,t){var r;PPx.StayMode=0,t=null!=(r=t)?r:"","DEBUG"===e&&PPx.linemessage("[DEBUG] discard "+t)},r={hold:function(e,t){var r=PPx.StayMode,n="ppm_sm"+r,a="%sgu'ppmlib'\\discardStayMode.js";PPx.Execute("*run -noppb -hide -nostartmsg %0ppbw.exe -c *wait "+e+"%%:*script "+a+","+n+","+r+","+t)},ppx_Discard:ppx_Discard},n={sortDetail:function(e,t,r){return 0!==e&&(e=1),{0:{l:-1,r:1,msg:t},1:{l:1,r:-1,msg:r}}[e]},pathDetail:function(e){var t={path:"",wd:"",name:"",ext:"",type:0},r=/^(.*)\\((?:.*\.)?(?!$)(.*))/;return PPx.Extract(e).replace(r,(function(e,r,n,a){return t.path=e+"\\",t.wd=r,t.name=n,t.ext="."+a.toLowerCase(),t.type=PPx.DirectoryType,""})),t.wd?t:undefined}},a="<<Root>>",i="<Top>",u="<Bottom>",o={en:{noItem:"No adjacent directories",notSupport:"Not supported"},ja:{noItem:"隣接ディレクトリはありません",notSupport:"非対象"}}[useLanguage()],p={},main=function(){var e=validArgs(),t=e[0],n=e[1],a=e[2],i=hasDebounceTime(n);i&&(PPx.StayMode=2,"DEBUG"===a&&PPx.linemessage("[DEBUG] start "+PPx.StayMode),r.hold(n,a)),ppx_resume(t,"0",i)},hasDebounceTime=function(e){var t=Number(e);return!isNaN(t)&&t>=1e3},ppx_resume=function(e,t,r){void 0===e&&(e="1"),void 0===t&&(t="5000"),void 0===r&&(r=!0);var o=n.sortDetail(Number(e),i,u),p=getPwd(),s=p[0],c=p[1],l=n.pathDetail(s);if(l){var f=candidates(l,o,r);if("string"!=typeof f){var d=f.indexOf(l.path),x=getAdjacentPath(d,f,s,c);if(f[d-2]||PPx.linemessage('!"'+o.msg),f[d-1]&&PPx.Execute('*jumppath "'+x+'"'),r){var P="ppm_sm"+PPx.StayMode;PPx.Execute("*string u,"+P+"="+t)}}else PPx.linemessage('!"'+f)}else PPx.linemessage('!"'+a)},getPwd=function(){var e=PPx.Extract("%FDVN");return 0===e.indexOf("#:")?[PPx.Extract("%FDN"),e]:[e]},sortItems=function(e,t,r,n){var a;if(n&&p.wd===e.wd&&e.type<61)a=p.data;else if(n&&p.wd===e.wd&&e.type>=61&&p.ext===e.ext)a=p.data;else{var i,u=tmp().file,s='-mask:"'+r+'" -utf8 -dir:on -subdir:off -listfile:'+u+" -name";PPx.Execute('*whereis -path:"'+e.wd+'\\" '+s);var c=readLines({path:u});if(i=c[0],a=c[1],isError(i,a))return a;p={wd:e.wd,ext:e.ext,data:a}}return a.lines.length<=1?o.noItem:a.lines.sort((function(e,r){return e.toLowerCase()<r.toLowerCase()?t.l:t.r}))},candidates=function(e,t,r){switch(e.type){case 0:case 1:case 3:return sortItems(e,t,"a:d+s-",r);case 4:case 61:case 62:case 63:case 64:case 96:return e.path=e.path.slice(0,-1),sortItems(e,t,e.ext,r);default:return"DirectoryType: "+e.type+", "+o.notSupport}},getAdjacentPath=function(e,t,r,n){var a=t[Math.max(e-1,0)];if(!n)return a;var i=/[/\\][^/\\]+$/;return r=r.replace(i,""),n=n.replace(i,""),a.replace(r,n)};main();
