Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var r;if(null==this)throw new TypeError('Array.indexOf: "this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var i=null!=e?e:0;if(Math.abs(i)===Infinity&&(i=0),i>=a)return-1;for(r=Math.max(i>=0?i:a-Math.abs(i),0);r<a;){if(r in n&&n[r]===t)return r;r++}return-1});var t=PPx.CreateObject("Scripting.FileSystemObject"),e="jp",r=function(t,e){try{var r;return[!1,null!=(r=e())?r:""]}catch(n){return[!0,""]}finally{t.Close()}},n=function(e){var n=e.path,a=e.enc,i=function(e){var n=e.path,a=e.enc,i=void 0===a?"utf8":a;if(!t.FileExists(n))return[!0,n+" not found"];var u=t.GetFile(n);if(0===u.Size)return[!0,n+" has no data"];var o=!1,p="";if("utf8"===i){var s=PPx.CreateObject("ADODB.Stream"),c=r(s,(function(){return s.Open(),s.Charset="UTF-8",s.LoadFromFile(n),s.ReadText(-1)}));o=c[0],p=c[1]}else{var f="utf16le"===i?-1:0,l=u.OpenAsTextStream(1,f),x=r(l,(function(){return l.ReadAll()}));o=x[0],p=x[1]}return o?[!0,"Unable to read "+n]:[!1,p]}({path:n,enc:void 0===a?"utf8":a}),u=i[0],o=i[1];if(u)return[!0,o];var p=function(t){var e="\n",r=t.indexOf("\r");return~r&&(e="\r\n"==t.substring(r,r+2)?"\r\n":"\r"),e}(o.slice(0,1e3)),s=o.split(p);return""===s[s.length-1]&&s.pop(),[!1,{lines:s,nl:p}]},a=function(t,e,r){return/^[01]$/.test(t)||(t="1"),{0:{l:-1,r:1,msg:e},1:{l:1,r:-1,msg:r}}[t]},i=function(t){var e={path:"",pwd:"",name:"",ext:"",type:0};return PPx.Extract(t).replace(/^(.*)\\((?:.*\.)?(?!$)(.*))/,(function(t,r,n,a){return e.path=t+"\\",e.pwd=r,e.name=n,e.ext="."+a.toLowerCase(),e.type=PPx.DirectoryType,""})),e.pwd?e:undefined},u={en:{noItem:"No adjacent directories",notSupport:"Not supported"},jp:{noItem:"隣接ディレクトリはありません",notSupport:"非対象"}}[function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"jp"===t?t:e}()],o=function(){var t=PPx.Extract("%FDVN");return 0===t.indexOf("#:")?[PPx.Extract("%FDN"),t]:[t]},p=function(t,e,r){var a,i=(a=PPx.Extract('%*extract(C,"%%*temp()")'),{dir:a,file:a+"_ppmtemp",stdout:a+"_stdout",stderr:a+"_stderr",ppmDir:function(){var t=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+t),t}}).file,o='-mask:"'+r+'" -utf8 -dir:on -subdir:off -listfile:'+i+" -name";PPx.Execute('*whereis -path:"'+t+'\\" '+o);var p=n({path:i}),s=p[0],c=p[1];return function(t,e){return t&&"string"==typeof e}(s,c)?c:c.lines.length<=1?u.noItem:c.lines.sort((function(t,r){return t.toLowerCase()<r.toLowerCase()?e.l:e.r}))},s=function(t,e){switch(t.type){case 0:case 1:case 3:return p(t.pwd,e,"a:d+s-");case 4:case 63:case 64:case 96:return t.path=t.path.slice(0,-1),p(t.pwd,e,t.ext);default:return"DirectoryType: "+t.type+", "+u.notSupport}},c=function(t,e,r,n){var a=e[Math.max(t-1,0)];if(!n)return a;var i=/[/\\][^/\\]+$/;return r=r.replace(i,""),n=n.replace(i,""),a.replace(r,n)};!function(){var t=PPx.Arguments.length>0?PPx.Arguments.Item(0):"1",e=a(t,"<Top>","<Bottom>"),r=o(),n=r[0],u=r[1],p=i(n);p||(PPx.linemessage('!"<<Root>>'),PPx.Quit(1));var f=s(p,e);"string"==typeof f&&(PPx.linemessage('!"'+f),PPx.Quit(1));var l=f.indexOf(p.path),x=c(l,f,n,u);f[l-2]||PPx.linemessage('!"'+e.msg),f[l-1]&&PPx.Execute('*jumppath "'+x+'"')}();
