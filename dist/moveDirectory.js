var t=PPx.CreateObject("Scripting.FileSystemObject"),e="jp",r=function(t,e){try{var r;return[!1,null!=(r=e())?r:""]}catch(n){return[!0,""]}finally{t.Close()}},n=function(e){var n=e.path,a=e.enc,u=function(e){var n=e.path,a=e.enc,u=void 0===a?"utf8":a;if(!t.FileExists(n))return[!0,n+" not found"];var i=t.GetFile(n);if(0===i.Size)return[!0,n+" has no data"];var o=!1,p="";if("utf8"===u){var c=PPx.CreateObject("ADODB.Stream"),s=r(c,(function(){return c.Open(),c.Charset="UTF-8",c.LoadFromFile(n),c.ReadText(-1)}));o=s[0],p=s[1]}else{var f="utf16le"===u?-1:0,l=i.OpenAsTextStream(1,f),x=r(l,(function(){return l.ReadAll()}));o=x[0],p=x[1]}return o?[!0,"Unable to read "+n]:[!1,p]}({path:n,enc:void 0===a?"utf8":a}),i=u[0],o=u[1];if(i)return[!0,o];var p=function(t){var e="\n",r=t.indexOf("\r");return~r&&(e="\r\n"==t.substring(r,r+2)?"\r\n":"\r"),e}(o.slice(0,1e3)),c=o.split(p);return""===c[c.length-1]&&c.pop(),[!1,{lines:c,nl:p}]},a=function(t,e,r){return/^[01]$/.test(t)||(t="1"),{0:{l:-1,r:1,msg:e},1:{l:1,r:-1,msg:r}}[t]},u=function(t){var e={path:"",pwd:"",name:"",ext:"",type:0};return PPx.Extract(t).replace(/^(.*)\\((?:.*\.)?(?!$)(.*))/,(function(t,r,n,a){return e.path=t+"\\",e.pwd=r,e.name=n,e.ext="."+a.toLowerCase(),e.type=PPx.DirectoryType,""})),e.pwd?e:undefined},i={en:{noItem:"No adjacent directories",notSupport:"Not supported"},jp:{noItem:"隣接ディレクトリはありません",notSupport:"非対象"}}[function(){var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===t||"jp"===t?t:e}()],o=function(){var t=PPx.Extract("%FDVN");return 0===t.indexOf("#:")?[PPx.Extract("%FDN"),t]:[t]},p=function(t,e,r){var a,u=(a=PPx.Extract('%*extract(C,"%%*temp()")'),{dir:a,file:a+"_ppmtemp",stdout:a+"_stdout",stderr:a+"_stderr",ppmDir:function(){var t=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+t),t}}).file,o='-mask:"'+r+'" -utf8 -dir:on -subdir:off -listfile:'+u+" -name";PPx.Execute('*whereis -path:"'+t+'\\" '+o);var p=n({path:u}),c=p[0],s=p[1];return function(t,e){return t&&"string"==typeof e}(c,s)?s:s.lines.length<=1?i.noItem:s.lines.sort((function(t,r){return t.toLowerCase()<r.toLowerCase()?e.l:e.r}))},c=function(t,e){switch(t.type){case 0:case 1:case 3:return p(t.pwd,e,"a:d+s-");case 4:case 63:case 64:case 96:return t.path=t.path.slice(0,-1),p(t.pwd,e,t.ext);default:return"DirectoryType: "+t.type+", "+i.notSupport}},s=function(t,e,r,n){var a=e[Math.max(t-1,0)];if(!n)return a;var u=/[/\\][^/\\]+$/;return r=r.replace(u,""),n=n.replace(u,""),a.replace(r,n)};!function(){var t=PPx.Arguments.length>0?PPx.Arguments.Item(0):"1",e=a(t,"<Top>","<Bottom>"),r=o(),n=r[0],i=r[1],p=u(n);p||(PPx.linemessage('!"<<Root>>'),PPx.Quit(1));var f=c(p,e);"string"==typeof f&&(PPx.linemessage('!"'+f),PPx.Quit(1));var l=f.indexOf(p.path),x=s(l,f,n,i);f[l-2]||PPx.linemessage('!"'+e.msg),f[l-1]&&PPx.Execute('*jumppath "'+x+'"')}();
